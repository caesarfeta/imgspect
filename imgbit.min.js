function TimeStamp(){}function Culuh(t){this.r=0,this.g=0,this.b=0,this.h=0,this.s=0,this.v=0,void 0!=t&&(this.original=t,this.reset(),this.hsvUpdate())}!function(t){function e(t,e,i){var r=this;r.elem=t,r.id=i,r.init(t,e)}e.prototype.init=function(e,i){var r=this;r.options=t.extend({style:"full",closable:!1},i),r.events={change:"IMGBIT-CHANGE",closed:"IMGBIT-CLOSED",frame:"IMGBIT-FRAME"},r.original=t(r.elem).myHtml(),r.href=t(r.elem).attr("href"),r.caption=t(r.elem).text(),r.imgWidth=null,r.imgHeight=null;var a=new TimeStamp;r.timeCreated=a.withUtc(!0);var n=r.href.split("imgbit=");r.src=r.href,r.param={},n.length>1&&(r.src=n[0].substring(0,n[0].length-1),r.param=r.getToJson(n[1])),r.specClass(),r.build()},e.prototype.specClass=function(){var e=this;t(e.elem).hasClass("min")&&(e.options.style=null),t(e.elem).hasClass("edit")&&(e.options.style="edit"),t(e.elem).hasClass("closable")&&(e.options.closable=!0)},e.prototype.fixParams=function(){var t=this;void 0!=t.param.w&&(t.param.z=t.param.w/(t.param.x2-t.param.x1)),void 0!=t.param.h&&(t.param.z=t.param.h/(t.param.y2-t.param.y1)),void 0!=t.param.c&&(t.culuh=new Culuh(t.param.c)),t.param.z=void 0==t.param.z?1:t.param.z},e.prototype.build=function(){var e=this,i=t(e.elem).attr("id");t(e.elem).after('<div class="imgbit">'),e.elem=t(e.elem).next(),t(e.elem).attr("id",i);var r=t(e.elem).prev(),a=r.html();r.remove(),null!=e.options.style&&t(e.elem).addClass(e.options.style),t(e.elem).append('<div class="view">'),t(e.elem).append('<div class="text">'+a+"</div>"),t(".text",e.elem).hide(),null!=e.options.style&&t(".text",e.elem).show();var n=new Image;n.onload=function(){t(this).addClass("star"),e.imgWidth=n.width,e.imgHeight=n.height,e.toExplicit(),e.fixParams(),t(".view",e.elem).append(this),e.viewCrop(),e.imgMove(),t(e.elem).prepend('<div style="clear:both"></div>'),null!=e.options.style&&"edit"!=e.options.style&&t(e.elem).prepend('<a class="source" href="'+e.src+'">source</a>'),t(e.elem).css({width:t(".view",e.elem).width()}),e.editStart(),1==e.options.closable&&e.closeBuild(),void 0!=e.param.c&&(t(e.elem).css({"background-color":"#"+e.param.c}),t(".close",e.elem).css({"background-color":"#"+e.param.c})),t(e.elem).trigger(e.events.change)},n.src=e.src},e.prototype.closeBuild=function(){var e=this;t(e.elem).prepend('<a href="" class="close">x</a>'),t(".close",e.elem).click(function(i){t(e.elem).trigger(e.events.closed),t(e.elem).trigger(e.events.change),i.preventDefault()})},e.prototype.captionResize=function(){var e=t(".text",this.elem),i=!1;0==e.is(":visible")&&(i=!0),e.show();var r=e.height();1==i&&e.hide();var a=parseInt(e.css("font-size").replace("px","")),n=r>a?r:a;t(".caption",this.elem).height(n)},e.prototype.editStart=function(){var e=this;"edit"==e.options.style&&(e.editBuild(),e.captionResize(),t(".caption",e.elem).keypress(function(t){13==t.which&&e.editSwitch()}),t(".caption",e.elem).bind("input propertychange",function(){e.setCaption(t(".caption",e.elem).val())}))},e.prototype.remove=function(){t(this.elem).remove()},e.prototype.setCaption=function(e){var i=this;i.caption=e,t(".text",i.elem).text(i.caption),i.captionResize(),t(i.elem).trigger(i.events.change)},e.prototype.idUpdate=function(e){t(this.elem).attr("id",e)},e.prototype.editBuild=function(){var e=this,i='<textarea class="caption">'+t(".text",e.elem).text()+"</textarea>";t(".text",e.elem).after(i),t(".caption",e.elem).css({width:t(".view",e.elem).width()}),void 0!=e.culuh&&t(".caption",e.elem).css({"background-color":e.culuh.sat(.35,!0).hex()}),t(".caption",e.elem).hide(),t(".text",e.elem).on("touchstart click",function(t){t.preventDefault(),e.editSwitch()}),t(document).on("touchstart click",function(i){t(i.target).html()!=t(".caption",e.elem).html()&&t(i.target).html()!=t(".text",e.elem).html()&&e.editHide()})},e.prototype.editSwitch=function(){var i=this;t(".caption",i.elem).is(":visible")?i.editHide():(e.prototype.editHide(),i.editShow())},e.prototype.editHide=function(){t(".caption",this.elem).hide(),t(".text",this.elem).show()},e.prototype.editShow=function(){var e=this;t(".text",e.elem).hide(),t(".caption",e.elem).show(),t(".caption",e.elem).cursorToEnd()},e.prototype.viewCrop=function(){var e=this;t(".view",e.elem).css({width:(e.param.x2-e.param.x1)*e.param.z,height:(e.param.y2-e.param.y1)*e.param.z}),t(e.elem).css({width:(e.param.x2-e.param.x1)*e.param.z})},e.prototype.imgMove=function(){var e=this;t("img.star",e.elem).css({width:e.imgWidth*e.param.z,height:e.imgHeight*e.param.z,left:-1*e.param.x1*e.param.z,top:-1*e.param.y1*e.param.z})},e.prototype.sequence=function(e,i,r){var a=this;if(r=void 0!=r?r:0,i=void 0!=i&&i,e.length<=r)1==i&&a.sequence(e,i,0);else{a.param.x1=e[r].coords[0],a.param.y1=e[r].coords[1],a.param.x2=e[r].coords[2]+a.param.x1,a.param.y2=e[r].coords[3]+a.param.y1,a.param.z=e[r].coords[4];var n=void 0==e[r].wipe?1:e[r].wipe,o=void 0==e[r].stay?5:e[r].stay;t("img.star, .view",a.elem).css({transition:"all "+n+"s","-webkit-transition":"all "+n+"s"}),t(a.elem).css({transition:"all "+n+"s","-webkit-transition":"all "+n+"s"}),a.imgMove(),a.viewCrop(),t(".caption",a.elem).hide();var s=null;"caption"in e[r]&&(s=e[r].caption,"min"==a.options.style&&null==a.options.style||(t(".caption",a.elem).show(),a.setCaption(s))),r++,setTimeout(function(){a.sequence(e,i,r)},1e3*(o+n)),t(a.elem).trigger(a.events.frame,{caption:s})}},e.prototype.getToJson=function(t){if(""==t||void 0==t)return{};for(var e={},i=t.split("%"),r=0,a=i.length;r<a;r++){var n=i[r].split("=");2==n.length&&(e[n[0]]=decodeURIComponent(n[1].replace(/\+/g,"")))}return e},e.prototype.html=function(){var t=this,e=-1==t.src.indexOf("?")?"?":"&";return('<a class="imgbit" \t\t\t\t\t\thref="'+t.src+"\t\t\t\t\t\t"+e+"imgbit=\t\t\t\t\t\tx1="+t.param.x1+"\t\t\t\t\t\t%y1="+t.param.y1+"\t\t\t\t\t\t%x2="+t.param.x2+"\t\t\t\t\t\t%y2="+t.param.y2+"\t\t\t\t\t\t%c="+t.param.c+"\t\t\t\t\t\t%z="+t.param.z+'">\t\t\t\t\t\t'+t.caption+"\t\t\t\t\t<a>").smoosh()},e.prototype.sequenceFormat=function(){var t=this;return{coords:[parseInt(t.param.x1),parseInt(t.param.y1),parseInt(t.param.x2)-parseInt(t.param.x1),parseInt(t.param.y2)-parseInt(t.param.y1),t.param.z],caption:t.caption}},e.prototype.relative=function(){return this.citeCoords()},e.prototype.citeCoords=function(){var t=this,e=[];e[0]=t.param.x1/t.imgWidth,e[1]=t.param.y1/t.imgHeight,e[2]=(t.param.x2-t.param.x1)/t.imgWidth,e[3]=(t.param.y2-t.param.y1)/t.imgHeight;for(var i=0,r=e.length;i<r;i++)e[i]=e[i].toFixed(4);return e},e.prototype.toExplicit=function(){var t=this;t.param.w<=1&&t.param.h<=1&&t.param.x<=1&&t.param.y<=1&&(t.param.x1=t.param.x*t.imgWidth,t.param.y1=t.param.y*t.imgHeight,t.param.x2=t.param.x1+t.param.w*t.imgWidth,t.param.y2=t.param.y1+t.param.h*t.imgHeight,delete t.param.x,delete t.param.y,delete t.param.w,delete t.param.h)},e.prototype.toJsonLD=function(t){return{"@context":"http://www.w3.org/ns/oa-context-20130208.json","@type":"oa:Annotation",annotatedAt:this.timeCreated,annotatedBy:{"@type":"foaf:Person"},motivatedBy:"perseus:transcribing",label:"isQuotationOf"}},jQuery(document).ready(function(t){jQuery.fn.imgbit=function(t){var i=jQuery(this).selector;return this.each(function(){jQuery.data(this,i,new e(this,t,i))})}})}(jQuery),jQuery.fn.cursorToEnd=function(){return this.each(function(){if(jQuery(this).focus(),this.setSelectionRange){var t=2*jQuery(this).val().length;this.setSelectionRange(t,t)}else jQuery(this).val(jQuery(this).val());this.scrollTop=999999})},jQuery.fn.noSpace=function(){return textNodes=this.contents().filter(function(){return 3==this.nodeType&&!/\S/.test(this.nodeValue)}).remove(),this},jQuery.fn.myHtml=function(){return jQuery(this).clone().wrap("<div>").parent().html()},jQuery.fn.transLength=function(){var t=jQuery(this).css("transition").match(/ [\d|\.]+s/g);return 1e3*Number(t[0].replace("s",""))},String.prototype.smoosh=function(){return this.replace(/(\r\n+|\n+|\r+|\t+)/gm,"")},String.prototype.splice=function(t,e){return this.slice(0,Math.abs(e))+t+this.slice(Math.abs(e))},String.prototype.stripTags=function(){return this.replace(/<\/?[^>]+(>|$)/g,"")},String.prototype.oneSpace=function(){return this.replace(/\s{2,}/g," ")},String.prototype.alphaSpaceOnly=function(){return this.replace(/[^\w\s]/gi,"")},String.prototype.alphaOnly=function(){return this.replace(/[^\w]/gi,"")},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.repeat=function(t){return new Array(t+1).join(this)},String.prototype.occurs=function(t,e){if(void 0==t)return this.length;if((t+="").length<=0)return this.length;for(var i=0,r=0,a=e?1:t.length;(r=this.indexOf(t,r))>=0;)i++,r+=a;return i},String.prototype.positions=function(t,e,i,r){var a=this;t+="";for(var n=0,o=e?1:t.length,s=[];;){var p=!0;if(!((n=a.indexOf(t,n))>=0))break;if(1==i)for(var h=n;h<a.length&&"<"!=a[h];h++)">"==a[h]&&(p=!1);1==r&&1==a.substr(n-1,n+t.length+1).isAlphaNum()&&(p=!1),1==p&&s.push(n),n+=o}return s},String.prototype.insertAt=function(t,e){return this.substr(0,t)+e+this.substr(t)},String.prototype.params=function(){for(var t=this.split("?"),e={},i=0,r=(t=t[1].split("&")).length;i<r;i++)if(void 0!=t[i]){var a=t[i].split("=");e[a[0]]=a[1]}return e},String.prototype.hasUpper=function(){return/[A-Z]/.test(this)},String.prototype.report=function(){for(var t=this.toLowerCase().split(" "),e={},i=0,r=t.length;i<r;i++){var a=t[i];a in e?e[a]+=1:e[a]=1}return e},String.prototype.lines=function(){return this.split("\n")},String.prototype.isAlphaNum=function(){return!/[^a-zA-Z0-9]/.test(this)},String.prototype.sentences=function(){for(var t=this.match(/[^\.!\?]+[\.!\?]+/g),e=["a","e","i","o","u","y"],i=[],r="",a=0;a<t.length;a++){var n=r+t[a];r="";for(var o=!0,s=0;s<e.length;s++)if(-1!=n.indexOf(e[s])){o=!1;break}n.trim()[0].hasUpper()||(o=!0),o?i.length>0?i[i.length-1]+=n:r=n:i.push(n.smoosh().trim())}return i},TimeStamp.prototype.withUtc=function(t){var e=new Date,i=e.getFullYear(),r=("0"+(e.getMonth()+1)).slice(-2),a=("0"+e.getDate()).slice(-2),n=e.getHours(),o=("0"+e.getMinutes()).slice(-2),s=("0"+e.getSeconds()).slice(-2),p=("0"+e.getMilliseconds()).slice(-3),h=e.getTimezoneOffset(),l="";return l=t?i+"-"+r+"-"+a+"T"+n+":"+o+":"+s+":"+p+"UTC":i+"-"+r+"-"+a+"T"+n+":"+o+":"+s+"UTC",l=h>0?l+"+"+h:l+"-"+h},TimeStamp.prototype.unix=function(){return(new Date).getTime()},TimeStamp.prototype.toUnix=function(t){var e=t.replace(/UTC.*/,""),i=0;return e.match(/:\d{3}/)&&(i=e.slice(-4),e=e.replace(/:\d+$/,""),i=parseInt(i.replace(":",""))),Date.parse(e).getTime()+i},Culuh.prototype.reset=function(){var t=this.original;if((t=t.toUpperCase()).indexOf("RGB")>-1){var e=t.match(/\d+\.?\d*/g);this.r=parseInt(e[0]),this.g=parseInt(e[1]),this.b=parseInt(e[2])}else{e=t.match(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i);this.r=this.hexToInt(e[1]),this.g=this.hexToInt(e[2]),this.b=this.hexToInt(e[3])}},Culuh.prototype.hsvUpdate=function(){var t,e,i,r=this.r/255,a=this.g/255,n=this.b/255,o=Math.min(r,a,n),s=Math.max(r,a,n),p=s-o;i=s,0==(e=0==s?0:p/s)?t=0:(t=r==s?(a-n)/p:a==s?2+(n-r)/p:4+(r-a)/p,isNaN(t)&&(t=0),(t/=6)<0&&t++),this.h=255*t,this.s=255*e,this.v=255*i},Culuh.prototype.rgbUpdate=function(){var t,e,i,r=this.h/255,a=this.s/255,n=this.v/255;if(0==a)t=e=i=n;else{var o=(r*=6)%1,s=n*(1-a),p=n*(1-a*o),h=n*(1-a*(1-o));switch(Math.floor(r)){case 0:t=n,e=h,i=s;break;case 1:t=p,e=n,i=s;break;case 2:t=s,e=n,i=h;break;case 3:t=s,e=p,i=n;break;case 4:t=h,e=s,i=n;break;case 5:t=n,e=s,i=p}}this.r=parseInt(255*t),this.g=parseInt(255*e),this.b=parseInt(255*i)},Culuh.prototype.hex=function(t){return(t=void 0==t?"":t)+this.rHex()+this.gHex()+this.bHex()},Culuh.prototype.rgb=function(){return"rgb("+this.r+","+this.g+","+this.b+")"},Culuh.prototype.rHex=function(){return this.intToHex(this.r)},Culuh.prototype.gHex=function(){return this.intToHex(this.g)},Culuh.prototype.bHex=function(){return this.intToHex(this.b)},Culuh.prototype.rInt=function(){return this.r},Culuh.prototype.gInt=function(){return this.g},Culuh.prototype.bInt=function(){return this.b},Culuh.prototype.hexToInt=function(t){return parseInt(t,16)},Culuh.prototype.intToHex=function(t){var e=t.toString(16);return e.length<2&&(e="0"+e),e.toUpperCase()},Culuh.prototype.sat=function(t,e){var i=this.s;if(i*=t,1==e){var r=new Culuh(this.rgb());return r.sat(t),r}this.s=i,this.rgbUpdate()},Culuh.prototype.toAlpha=function(t){return t=(t=(t=parseFloat(t))<0?0:t)>1?1:t,"rgba("+this.r+","+this.g+","+this.b+","+t+")"},Culuh.prototype.invert=function(t){if(1==t){var e=new Culuh(this.rgb());return e.invert(),e}this.r=255-this.r,this.g=255-this.g,this.b=255-this.b,this.hsvUpdate()};