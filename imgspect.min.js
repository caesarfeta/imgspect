function TimeStamp(){}function Culuh(t){this.r=0,this.g=0,this.b=0,this.h=0,this.s=0,this.v=0,void 0!=t&&(this.original=t,this.reset(),this.hsvUpdate())}function Sorted(){}!function(t){if(t.support.touch="ontouchend"in document,t.support.touch){var e,n=t.ui.mouse.prototype,i=n._mouseInit;n._touchStart=function(t){!e&&this._mouseCapture(t.originalEvent.changedTouches[0])&&(e=!0,this._touchMoved=!1,o(t,"mouseover"),o(t,"mousemove"),o(t,"mousedown"))},n._touchMove=function(t){e&&(this._touchMoved=!0,o(t,"mousemove"))},n._touchEnd=function(t){e&&(o(t,"mouseup"),o(t,"mouseout"),this._touchMoved||o(t,"click"),e=!1)},n._mouseInit=function(){var e=this;e.element.bind("touchstart",t.proxy(e,"_touchStart")).bind("touchmove",t.proxy(e,"_touchMove")).bind("touchend",t.proxy(e,"_touchEnd")),i.call(e)}}function o(t,e){if(!(t.originalEvent.touches.length>1)){t.preventDefault();var n=t.originalEvent.changedTouches[0],i=document.createEvent("MouseEvents");i.initMouseEvent(e,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(i)}}}(jQuery),jQuery.fn.cursorToEnd=function(){return this.each(function(){if(jQuery(this).focus(),this.setSelectionRange){var t=2*jQuery(this).val().length;this.setSelectionRange(t,t)}else jQuery(this).val(jQuery(this).val());this.scrollTop=999999})},jQuery.fn.noSpace=function(){return textNodes=this.contents().filter(function(){return 3==this.nodeType&&!/\S/.test(this.nodeValue)}).remove(),this},jQuery.fn.myHtml=function(){return jQuery(this).clone().wrap("<div>").parent().html()},jQuery.fn.transLength=function(){var t=jQuery(this).css("transition").match(/ [\d|\.]+s/g);return 1e3*Number(t[0].replace("s",""))},String.prototype.smoosh=function(){return this.replace(/(\r\n+|\n+|\r+|\t+)/gm,"")},String.prototype.splice=function(t,e){return this.slice(0,Math.abs(e))+t+this.slice(Math.abs(e))},String.prototype.stripTags=function(){return this.replace(/<\/?[^>]+(>|$)/g,"")},String.prototype.oneSpace=function(){return this.replace(/\s{2,}/g," ")},String.prototype.alphaSpaceOnly=function(){return this.replace(/[^\w\s]/gi,"")},String.prototype.alphaOnly=function(){return this.replace(/[^\w]/gi,"")},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.repeat=function(t){return new Array(t+1).join(this)},String.prototype.occurs=function(t,e){var n=this;if(void 0==t)return n.length;if((t+="").length<=0)return n.length;for(var i=0,o=0,r=e?1:t.length;(o=n.indexOf(t,o))>=0;)i++,o+=r;return i},String.prototype.positions=function(t,e,n,i){var o=this;t+="";for(var r=0,a=e?1:t.length,s=[];;){var u=!0;if(!((r=o.indexOf(t,r))>=0))break;if(1==n)for(var c=r;c<o.length&&"<"!=o[c];c++)">"==o[c]&&(u=!1);1==i&&1==o.substr(r-1,r+t.length+1).isAlphaNum()&&(u=!1),1==u&&s.push(r),r+=a}return s},String.prototype.insertAt=function(t,e){return this.substr(0,t)+e+this.substr(t)},String.prototype.params=function(){for(var t=this.split("?"),e={},n=0,i=(t=t[1].split("&")).length;n<i;n++)if(void 0!=t[n]){var o=t[n].split("=");e[o[0]]=o[1]}return e},String.prototype.hasUpper=function(){return/[A-Z]/.test(this)},String.prototype.report=function(){for(var t=this.toLowerCase().split(" "),e={},n=0,i=t.length;n<i;n++){var o=t[n];o in e?e[o]+=1:e[o]=1}return e},String.prototype.lines=function(){return this.split("\n")},String.prototype.isAlphaNum=function(){return!/[^a-zA-Z0-9]/.test(this)},String.prototype.sentences=function(){for(var t=this.match(/[^\.!\?]+[\.!\?]+/g),e=["a","e","i","o","u","y"],n=[],i="",o=0;o<t.length;o++){var r=i+t[o];i="";for(var a=!0,s=0;s<e.length;s++)if(-1!=r.indexOf(e[s])){a=!1;break}r.trim()[0].hasUpper()||(a=!0),a?n.length>0?n[n.length-1]+=r:i=r:n.push(r.smoosh().trim())}return n},Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|after|from)/i,subtract:/^(\-|before|ago)/i,yesterday:/^yesterday/i,today:/^t(oday)?/i,tomorrow:/^tomorrow/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^min(ute)?s?/i,hour:/^h(ou)?rs?/i,week:/^w(ee)?k/i,month:/^m(o(nth)?s?)?/i,day:/^d(ays?)?/i,year:/^y((ea)?rs?)?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a|p)/i},abbreviatedTimeZoneStandard:{GMT:"-000",EST:"-0400",CST:"-0500",MST:"-0600",PST:"-0700"},abbreviatedTimeZoneDST:{GMT:"-000",EDT:"-0500",CDT:"-0600",MDT:"-0700",PDT:"-0800"}},Date.getMonthNumberFromName=function(t){for(var e=Date.CultureInfo.monthNames,n=Date.CultureInfo.abbreviatedMonthNames,i=t.toLowerCase(),o=0;o<e.length;o++)if(e[o].toLowerCase()==i||n[o].toLowerCase()==i)return o;return-1},Date.getDayNumberFromName=function(t){for(var e=Date.CultureInfo.dayNames,n=Date.CultureInfo.abbreviatedDayNames,i=(Date.CultureInfo.shortestDayNames,t.toLowerCase()),o=0;o<e.length;o++)if(e[o].toLowerCase()==i||n[o].toLowerCase()==i)return o;return-1},Date.isLeapYear=function(t){return t%4==0&&t%100!=0||t%400==0},Date.getDaysInMonth=function(t,e){return[31,Date.isLeapYear(t)?29:28,31,30,31,30,31,31,30,31,30,31][e]},Date.getTimezoneOffset=function(t,e){return e?Date.CultureInfo.abbreviatedTimeZoneDST[t.toUpperCase()]:Date.CultureInfo.abbreviatedTimeZoneStandard[t.toUpperCase()]},Date.getTimezoneAbbreviation=function(t,e){var n,i=e?Date.CultureInfo.abbreviatedTimeZoneDST:Date.CultureInfo.abbreviatedTimeZoneStandard;for(n in i)if(i[n]===t)return n;return null},Date.prototype.clone=function(){return new Date(this.getTime())},Date.prototype.compareTo=function(t){if(isNaN(this))throw new Error(this);if(t instanceof Date&&!isNaN(t))return this>t?1:this<t?-1:0;throw new TypeError(t)},Date.prototype.equals=function(t){return 0===this.compareTo(t)},Date.prototype.between=function(t,e){var n=this.getTime();return n>=t.getTime()&&n<=e.getTime()},Date.prototype.addMilliseconds=function(t){return this.setMilliseconds(this.getMilliseconds()+t),this},Date.prototype.addSeconds=function(t){return this.addMilliseconds(1e3*t)},Date.prototype.addMinutes=function(t){return this.addMilliseconds(6e4*t)},Date.prototype.addHours=function(t){return this.addMilliseconds(36e5*t)},Date.prototype.addDays=function(t){return this.addMilliseconds(864e5*t)},Date.prototype.addWeeks=function(t){return this.addMilliseconds(6048e5*t)},Date.prototype.addMonths=function(t){var e=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+t),this.setDate(Math.min(e,this.getDaysInMonth())),this},Date.prototype.addYears=function(t){return this.addMonths(12*t)},Date.prototype.add=function(t){if("number"==typeof t)return this._orient=t,this;var e=t;return(e.millisecond||e.milliseconds)&&this.addMilliseconds(e.millisecond||e.milliseconds),(e.second||e.seconds)&&this.addSeconds(e.second||e.seconds),(e.minute||e.minutes)&&this.addMinutes(e.minute||e.minutes),(e.hour||e.hours)&&this.addHours(e.hour||e.hours),(e.month||e.months)&&this.addMonths(e.month||e.months),(e.year||e.years)&&this.addYears(e.year||e.years),(e.day||e.days)&&this.addDays(e.day||e.days),this},Date._validate=function(t,e,n,i){if("number"!=typeof t)throw new TypeError(t+" is not a Number.");if(t<e||t>n)throw new RangeError(t+" is not a valid value for "+i+".");return!0},Date.validateMillisecond=function(t){return Date._validate(t,0,999,"milliseconds")},Date.validateSecond=function(t){return Date._validate(t,0,59,"seconds")},Date.validateMinute=function(t){return Date._validate(t,0,59,"minutes")},Date.validateHour=function(t){return Date._validate(t,0,23,"hours")},Date.validateDay=function(t,e,n){return Date._validate(t,1,Date.getDaysInMonth(e,n),"days")},Date.validateMonth=function(t){return Date._validate(t,0,11,"months")},Date.validateYear=function(t){return Date._validate(t,1,9999,"seconds")},Date.prototype.set=function(t){var e=t;return e.millisecond||0===e.millisecond||(e.millisecond=-1),e.second||0===e.second||(e.second=-1),e.minute||0===e.minute||(e.minute=-1),e.hour||0===e.hour||(e.hour=-1),e.day||0===e.day||(e.day=-1),e.month||0===e.month||(e.month=-1),e.year||0===e.year||(e.year=-1),-1!=e.millisecond&&Date.validateMillisecond(e.millisecond)&&this.addMilliseconds(e.millisecond-this.getMilliseconds()),-1!=e.second&&Date.validateSecond(e.second)&&this.addSeconds(e.second-this.getSeconds()),-1!=e.minute&&Date.validateMinute(e.minute)&&this.addMinutes(e.minute-this.getMinutes()),-1!=e.hour&&Date.validateHour(e.hour)&&this.addHours(e.hour-this.getHours()),-1!==e.month&&Date.validateMonth(e.month)&&this.addMonths(e.month-this.getMonth()),-1!=e.year&&Date.validateYear(e.year)&&this.addYears(e.year-this.getFullYear()),-1!=e.day&&Date.validateDay(e.day,this.getFullYear(),this.getMonth())&&this.addDays(e.day-this.getDate()),e.timezone&&this.setTimezone(e.timezone),e.timezoneOffset&&this.setTimezoneOffset(e.timezoneOffset),this},Date.prototype.clearTime=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},Date.prototype.isLeapYear=function(){var t=this.getFullYear();return t%4==0&&t%100!=0||t%400==0},Date.prototype.isWeekday=function(){return!(this.is().sat()||this.is().sun())},Date.prototype.getDaysInMonth=function(){return Date.getDaysInMonth(this.getFullYear(),this.getMonth())},Date.prototype.moveToFirstDayOfMonth=function(){return this.set({day:1})},Date.prototype.moveToLastDayOfMonth=function(){return this.set({day:this.getDaysInMonth()})},Date.prototype.moveToDayOfWeek=function(t,e){var n=(t-this.getDay()+7*(e||1))%7;return this.addDays(0===n?n+=7*(e||1):n)},Date.prototype.moveToMonth=function(t,e){var n=(t-this.getMonth()+12*(e||1))%12;return this.addMonths(0===n?n+=12*(e||1):n)},Date.prototype.getDayOfYear=function(){return Math.floor((this-new Date(this.getFullYear(),0,1))/864e5)},Date.prototype.getWeekOfYear=function(t){var e=this.getFullYear(),n=this.getMonth(),i=this.getDate(),o=t||Date.CultureInfo.firstDayOfWeek,r=8-new Date(e,0,1).getDay();8==r&&(r=1);var a=(Date.UTC(e,n,i,0,0,0)-Date.UTC(e,0,1,0,0,0))/864e5+1,s=Math.floor((a-r+7)/7);if(s===o){e--;var u=8-new Date(e,0,1).getDay();s=2==u||8==u?53:52}return s},Date.prototype.isDST=function(){return console.log("isDST"),"D"==this.toString().match(/(E|C|M|P)(S|D)T/)[2]},Date.prototype.getTimezone=function(){return Date.getTimezoneAbbreviation(this.getUTCOffset,this.isDST())},Date.prototype.setTimezoneOffset=function(t){var e=this.getTimezoneOffset(),n=-6*Number(t)/10;return this.addMinutes(n-e),this},Date.prototype.setTimezone=function(t){return this.setTimezoneOffset(Date.getTimezoneOffset(t))},Date.prototype.getUTCOffset=function(){var t,e=-10*this.getTimezoneOffset()/6;return e<0?(t=(e-1e4).toString())[0]+t.substr(2):"+"+(t=(e+1e4).toString()).substr(1)},Date.prototype.getDayName=function(t){return t?Date.CultureInfo.abbreviatedDayNames[this.getDay()]:Date.CultureInfo.dayNames[this.getDay()]},Date.prototype.getMonthName=function(t){return t?Date.CultureInfo.abbreviatedMonthNames[this.getMonth()]:Date.CultureInfo.monthNames[this.getMonth()]},Date.prototype._toString=Date.prototype.toString,Date.prototype.toString=function(t){var e=this,n=function(t){return 1==t.toString().length?"0"+t:t};return t?t.replace(/dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?/g,function(t){switch(t){case"hh":return n(e.getHours()<13?e.getHours():e.getHours()-12);case"h":return e.getHours()<13?e.getHours():e.getHours()-12;case"HH":return n(e.getHours());case"H":return e.getHours();case"mm":return n(e.getMinutes());case"m":return e.getMinutes();case"ss":return n(e.getSeconds());case"s":return e.getSeconds();case"yyyy":return e.getFullYear();case"yy":return e.getFullYear().toString().substring(2,4);case"dddd":return e.getDayName();case"ddd":return e.getDayName(!0);case"dd":return n(e.getDate());case"d":return e.getDate().toString();case"MMMM":return e.getMonthName();case"MMM":return e.getMonthName(!0);case"MM":return n(e.getMonth()+1);case"M":return e.getMonth()+1;case"t":return e.getHours()<12?Date.CultureInfo.amDesignator.substring(0,1):Date.CultureInfo.pmDesignator.substring(0,1);case"tt":return e.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator;case"zzz":case"zz":case"z":return""}}):this._toString()},Date.now=function(){return new Date},Date.today=function(){return Date.now().clearTime()},Date.prototype._orient=1,Date.prototype.next=function(){return this._orient=1,this},Date.prototype.last=Date.prototype.prev=Date.prototype.previous=function(){return this._orient=-1,this},Date.prototype._is=!1,Date.prototype.is=function(){return this._is=!0,this},Number.prototype._dateElement="day",Number.prototype.fromNow=function(){var t={};return t[this._dateElement]=this,Date.now().add(t)},Number.prototype.ago=function(){var t={};return t[this._dateElement]=-1*this,Date.now().add(t)},function(){for(var t,e=Date.prototype,n=Number.prototype,i="sunday monday tuesday wednesday thursday friday saturday".split(/\s/),o="january february march april may june july august september october november december".split(/\s/),r="Millisecond Second Minute Hour Day Week Month Year".split(/\s/),a=function(t){return function(){return this._is?(this._is=!1,this.getDay()==t):this.moveToDayOfWeek(t,this._orient)}},s=0;s<i.length;s++)e[i[s]]=e[i[s].substring(0,3)]=a(s);for(var u=function(t){return function(){return this._is?(this._is=!1,this.getMonth()===t):this.moveToMonth(t,this._orient)}},c=0;c<o.length;c++)e[o[c]]=e[o[c].substring(0,3)]=u(c);for(var l=function(t){return function(){return"s"!=t.substring(t.length-1)&&(t+="s"),this["add"+t](this._orient)}},h=function(t){return function(){return this._dateElement=t,this}},p=0;p<r.length;p++)e[t=r[p].toLowerCase()]=e[t+"s"]=l(r[p]),n[t]=n[t+"s"]=h(t)}(),Date.prototype.toJSONString=function(){return this.toString("yyyy-MM-ddThh:mm:ssZ")},Date.prototype.toShortDateString=function(){return this.toString(Date.CultureInfo.formatPatterns.shortDatePattern)},Date.prototype.toLongDateString=function(){return this.toString(Date.CultureInfo.formatPatterns.longDatePattern)},Date.prototype.toShortTimeString=function(){return this.toString(Date.CultureInfo.formatPatterns.shortTimePattern)},Date.prototype.toLongTimeString=function(){return this.toString(Date.CultureInfo.formatPatterns.longTimePattern)},Date.prototype.getOrdinal=function(){switch(this.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}},function(){Date.Parsing={Exception:function(t){this.message="Parse error at '"+t.substring(0,10)+" ...'"}};for(var t=Date.Parsing,e=t.Operators={rtoken:function(e){return function(n){var i=n.match(e);if(i)return[i[0],n.substring(i[0].length)];throw new t.Exception(n)}},token:function(t){return function(t){return e.rtoken(new RegExp("^s*"+t+"s*"))(t)}},stoken:function(t){return e.rtoken(new RegExp("^"+t))},until:function(t){return function(e){for(var n=[],i=null;e.length;){try{i=t.call(this,e)}catch(t){n.push(i[0]),e=i[1];continue}break}return[n,e]}},many:function(t){return function(e){for(var n=[],i=null;e.length;){try{i=t.call(this,e)}catch(t){return[n,e]}n.push(i[0]),e=i[1]}return[n,e]}},optional:function(t){return function(e){var n=null;try{n=t.call(this,e)}catch(t){return[null,e]}return[n[0],n[1]]}},not:function(e){return function(n){try{e.call(this,n)}catch(t){return[null,n]}throw new t.Exception(n)}},ignore:function(t){return t?function(e){return[null,t.call(this,e)[1]]}:null},product:function(){for(var t=arguments[0],n=Array.prototype.slice.call(arguments,1),i=[],o=0;o<t.length;o++)i.push(e.each(t[o],n));return i},cache:function(e){var n={},i=null;return function(o){try{i=n[o]=n[o]||e.call(this,o)}catch(t){i=n[o]=t}if(i instanceof t.Exception)throw i;return i}},any:function(){var e=arguments;return function(n){for(var i=null,o=0;o<e.length;o++)if(null!=e[o]){try{i=e[o].call(this,n)}catch(t){i=null}if(i)return i}throw new t.Exception(n)}},each:function(){var e=arguments;return function(n){for(var i=[],o=null,r=0;r<e.length;r++)if(null!=e[r]){try{o=e[r].call(this,n)}catch(e){throw new t.Exception(n)}i.push(o[0]),n=o[1]}return[i,n]}},all:function(){var t=arguments,e=e;return e.each(e.optional(t))},sequence:function(n,i,o){return i=i||e.rtoken(/^\s*/),o=o||null,1==n.length?n[0]:function(e){for(var r=null,a=null,s=[],u=0;u<n.length;u++){try{r=n[u].call(this,e)}catch(t){break}s.push(r[0]);try{a=i.call(this,r[1])}catch(t){a=null;break}e=a[1]}if(!r)throw new t.Exception(e);if(a)throw new t.Exception(a[1]);if(o)try{r=o.call(this,r[1])}catch(e){throw new t.Exception(r[1])}return[s,r?r[1]:e]}},between:function(t,n,i){i=i||t;var o=e.each(e.ignore(t),n,e.ignore(i));return function(t){var e=o.call(this,t);return[[e[0][0],r[0][2]],e[1]]}},list:function(t,n,i){return n=n||e.rtoken(/^\s*/),i=i||null,t instanceof Array?e.each(e.product(t.slice(0,-1),e.ignore(n)),t.slice(-1),e.ignore(i)):e.each(e.many(e.each(t,e.ignore(n))),px,e.ignore(i))},set:function(n,i,o){return i=i||e.rtoken(/^\s*/),o=o||null,function(r){for(var a=null,s=null,u=null,c=null,l=[[],r],h=!1,p=0;p<n.length;p++){u=null,s=null,a=null,h=1==n.length;try{a=n[p].call(this,r)}catch(t){continue}if(c=[[a[0]],a[1]],a[1].length>0&&!h)try{u=i.call(this,a[1])}catch(t){h=!0}else h=!0;if(h||0!==u[1].length||(h=!0),!h){for(var d=[],m=0;m<n.length;m++)p!=m&&d.push(n[m]);(s=e.set(d,i).call(this,u[1]))[0].length>0&&(c[0]=c[0].concat(s[0]),c[1]=s[1])}if(c[1].length<l[1].length&&(l=c),0===l[1].length)break}if(0===l[0].length)return l;if(o){try{u=o.call(this,l[1])}catch(e){throw new t.Exception(l[1])}l[1]=u[1]}return l}},forward:function(t,e){return function(n){return t[e].call(this,n)}},replace:function(t,e){return function(n){var i=t.call(this,n);return[e,i[1]]}},process:function(t,e){return function(n){var i=t.call(this,n);return[e.call(this,i[0]),i[1]]}},min:function(e,n){return function(i){var o=n.call(this,i);if(o[0].length<e)throw new t.Exception(i);return o}}},n=function(t){return function(){var e=null,n=[];if(arguments.length>1?e=Array.prototype.slice.call(arguments):arguments[0]instanceof Array&&(e=arguments[0]),!e)return t.apply(null,arguments);for(var i=0,o=e.shift();i<o.length;i++)return e.unshift(o[i]),n.push(t.apply(null,e)),e.shift(),n}},i="optional not ignore cache".split(/\s/),o=0;o<i.length;o++)e[i[o]]=n(e[i[o]]);for(var a=function(t){return function(){return arguments[0]instanceof Array?t.apply(null,arguments[0]):t.apply(null,arguments)}},s="each any all".split(/\s/),u=0;u<s.length;u++)e[s[u]]=a(e[s[u]])}(),function(){var t=function(e){for(var n=[],i=0;i<e.length;i++)e[i]instanceof Array?n=n.concat(t(e[i])):e[i]&&n.push(e[i]);return n};Date.Grammar={},Date.Translator={hour:function(t){return function(){this.hour=Number(t)}},minute:function(t){return function(){this.minute=Number(t)}},second:function(t){return function(){this.second=Number(t)}},meridian:function(t){return function(){this.meridian=t.slice(0,1).toLowerCase()}},timezone:function(t){return function(){var e=t.replace(/[^\d\+\-]/g,"");e.length?this.timezoneOffset=Number(e):this.timezone=t.toLowerCase()}},day:function(t){var e=t[0];return function(){this.day=Number(e.match(/\d+/)[0])}},month:function(t){return function(){this.month=3==t.length?Date.getMonthNumberFromName(t):Number(t)-1}},year:function(t){return function(){var e=Number(t);this.year=t.length>2?e:e+(e+2e3<Date.CultureInfo.twoDigitYearMax?2e3:1900)}},rday:function(t){return function(){switch(t){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0,this.now=!0}}},finishExact:function(t){t=t instanceof Array?t:[t];var e=new Date;this.year=e.getFullYear(),this.month=e.getMonth(),this.day=1,this.hour=0,this.minute=0,this.second=0;for(var n=0;n<t.length;n++)t[n]&&t[n].call(this);if(this.hour="p"==this.meridian&&this.hour<13?this.hour+12:this.hour,this.day>Date.getDaysInMonth(this.year,this.month))throw new RangeError(this.day+" is not a valid value for days.");var i=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);return this.timezone?i.set({timezone:this.timezone}):this.timezoneOffset&&i.set({timezoneOffset:this.timezoneOffset}),i},finish:function(e){if(0===(e=e instanceof Array?t(e):[e]).length)return null;for(var n=0;n<e.length;n++)"function"==typeof e[n]&&e[n].call(this);if(this.now)return new Date;var i,o,r,a=Date.today();return!(null==this.days&&!this.orient&&!this.operator)?(r="past"==this.orient||"subtract"==this.operator?-1:1,this.weekday&&(this.unit="day",i=Date.getDayNumberFromName(this.weekday)-a.getDay(),o=7,this.days=i?(i+r*o)%o:r*o),this.month&&(this.unit="month",i=this.month-a.getMonth(),o=12,this.months=i?(i+r*o)%o:r*o,this.month=null),this.unit||(this.unit="day"),null!=this[this.unit+"s"]&&null==this.operator||(this.value||(this.value=1),"week"==this.unit&&(this.unit="day",this.value=7*this.value),this[this.unit+"s"]=this.value*r),a.add(this)):(this.meridian&&this.hour&&(this.hour=this.hour<13&&"p"==this.meridian?this.hour+12:this.hour),this.weekday&&!this.day&&(this.day=a.addDays(Date.getDayNumberFromName(this.weekday)-a.getDay()).getDate()),this.month&&!this.day&&(this.day=1),a.set(this))}};var e,n=Date.Parsing.Operators,i=Date.Grammar,o=Date.Translator;i.datePartDelimiter=n.rtoken(/^([\s\-\.\,\/\x27]+)/),i.timePartDelimiter=n.stoken(":"),i.whiteSpace=n.rtoken(/^\s*/),i.generalDelimiter=n.rtoken(/^(([\s\,]|at|on)+)/);var r={};i.ctoken=function(t){var e=r[t];if(!e){for(var i=Date.CultureInfo.regexPatterns,o=t.split(/\s+/),a=[],s=0;s<o.length;s++)a.push(n.replace(n.rtoken(i[o[s]]),o[s]));e=r[t]=n.any.apply(null,a)}return e},i.ctoken2=function(t){return n.rtoken(Date.CultureInfo.regexPatterns[t])},i.h=n.cache(n.process(n.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),o.hour)),i.hh=n.cache(n.process(n.rtoken(/^(0[0-9]|1[0-2])/),o.hour)),i.H=n.cache(n.process(n.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),o.hour)),i.HH=n.cache(n.process(n.rtoken(/^([0-1][0-9]|2[0-3])/),o.hour)),i.m=n.cache(n.process(n.rtoken(/^([0-5][0-9]|[0-9])/),o.minute)),i.mm=n.cache(n.process(n.rtoken(/^[0-5][0-9]/),o.minute)),i.s=n.cache(n.process(n.rtoken(/^([0-5][0-9]|[0-9])/),o.second)),i.ss=n.cache(n.process(n.rtoken(/^[0-5][0-9]/),o.second)),i.hms=n.cache(n.sequence([i.H,i.mm,i.ss],i.timePartDelimiter)),i.t=n.cache(n.process(i.ctoken2("shortMeridian"),o.meridian)),i.tt=n.cache(n.process(i.ctoken2("longMeridian"),o.meridian)),i.z=n.cache(n.process(n.rtoken(/^(\+|\-)?\s*\d\d\d\d?/),o.timezone)),i.zz=n.cache(n.process(n.rtoken(/^(\+|\-)\s*\d\d\d\d/),o.timezone)),i.zzz=n.cache(n.process(i.ctoken2("timezone"),o.timezone)),i.timeSuffix=n.each(n.ignore(i.whiteSpace),n.set([i.tt,i.zzz])),i.time=n.each(n.optional(n.ignore(n.stoken("T"))),i.hms,i.timeSuffix),i.d=n.cache(n.process(n.each(n.rtoken(/^([0-2]\d|3[0-1]|\d)/),n.optional(i.ctoken2("ordinalSuffix"))),o.day)),i.dd=n.cache(n.process(n.each(n.rtoken(/^([0-2]\d|3[0-1])/),n.optional(i.ctoken2("ordinalSuffix"))),o.day)),i.ddd=i.dddd=n.cache(n.process(i.ctoken("sun mon tue wed thu fri sat"),function(t){return function(){this.weekday=t}})),i.M=n.cache(n.process(n.rtoken(/^(1[0-2]|0\d|\d)/),o.month)),i.MM=n.cache(n.process(n.rtoken(/^(1[0-2]|0\d)/),o.month)),i.MMM=i.MMMM=n.cache(n.process(i.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),o.month)),i.y=n.cache(n.process(n.rtoken(/^(\d\d?)/),o.year)),i.yy=n.cache(n.process(n.rtoken(/^(\d\d)/),o.year)),i.yyy=n.cache(n.process(n.rtoken(/^(\d\d?\d?\d?)/),o.year)),i.yyyy=n.cache(n.process(n.rtoken(/^(\d\d\d\d)/),o.year)),e=function(){return n.each(n.any.apply(null,arguments),n.not(i.ctoken2("timeContext")))},i.day=e(i.d,i.dd),i.month=e(i.M,i.MMM),i.year=e(i.yyyy,i.yy),i.orientation=n.process(i.ctoken("past future"),function(t){return function(){this.orient=t}}),i.operator=n.process(i.ctoken("add subtract"),function(t){return function(){this.operator=t}}),i.rday=n.process(i.ctoken("yesterday tomorrow today now"),o.rday),i.unit=n.process(i.ctoken("minute hour day week month year"),function(t){return function(){this.unit=t}}),i.value=n.process(n.rtoken(/^\d\d?(st|nd|rd|th)?/),function(t){return function(){this.value=t.replace(/\D/g,"")}}),i.expression=n.set([i.rday,i.operator,i.value,i.unit,i.orientation,i.ddd,i.MMM]),e=function(){return n.set(arguments,i.datePartDelimiter)},i.mdy=e(i.ddd,i.month,i.day,i.year),i.ymd=e(i.ddd,i.year,i.month,i.day),i.dmy=e(i.ddd,i.day,i.month,i.year),i.date=function(t){return(i[Date.CultureInfo.dateElementOrder]||i.mdy).call(this,t)},i.format=n.process(n.many(n.any(n.process(n.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(t){if(i[t])return i[t];throw Date.Parsing.Exception(t)}),n.process(n.rtoken(/^[^dMyhHmstz]+/),function(t){return n.ignore(n.stoken(t))}))),function(t){return n.process(n.each.apply(null,t),o.finishExact)});var a={},s=function(t){return a[t]=a[t]||i.format(t)[0]};i.formats=function(t){if(t instanceof Array){for(var e=[],i=0;i<t.length;i++)e.push(s(t[i]));return n.any.apply(null,e)}return s(t)},i._formats=i.formats(["yyyy-MM-ddTHH:mm:ss","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","d"]),i._start=n.process(n.set([i.date,i.time,i.expression],i.generalDelimiter,i.whiteSpace),o.finish),i.start=function(t){try{var e=i._formats.call({},t);if(0===e[1].length)return e}catch(t){}return i._start.call({},t)}}(),Date._parse=Date.parse,Date.parse=function(t){var e=null;if(!t)return null;try{e=Date.Grammar.start.call({},t)}catch(t){return null}return 0===e[1].length?e[0]:null},Date.getParseFunction=function(t){var e=Date.Grammar.formats(t);return function(t){var n=null;try{n=e.call({},t)}catch(t){return null}return 0===n[1].length?n[0]:null}},Date.parseExact=function(t,e){return Date.getParseFunction(e)(t)},TimeStamp.prototype.withUtc=function(t){var e=new Date,n=e.getFullYear(),i=("0"+(e.getMonth()+1)).slice(-2),o=("0"+e.getDate()).slice(-2),r=e.getHours(),a=("0"+e.getMinutes()).slice(-2),s=("0"+e.getSeconds()).slice(-2),u=("0"+e.getMilliseconds()).slice(-3),c=e.getTimezoneOffset(),l="";return l=t?n+"-"+i+"-"+o+"T"+r+":"+a+":"+s+":"+u+"UTC":n+"-"+i+"-"+o+"T"+r+":"+a+":"+s+"UTC",l=c>0?l+"+"+c:l+"-"+c},TimeStamp.prototype.unix=function(){return(new Date).getTime()},TimeStamp.prototype.toUnix=function(t){var e=t.replace(/UTC.*/,""),n=0;return e.match(/:\d{3}/)&&(n=e.slice(-4),e=e.replace(/:\d+$/,""),n=parseInt(n.replace(":",""))),Date.parse(e).getTime()+n},ObjectExt=function(){},ObjectExt.prototype.mergeAdd=function(t,e){for(var n in t)n in e?e[n]+=t[n]:e[n]=1},ObjectExt.prototype.totalChars=function(t,e,n){e=void 0==e?0:e,n=void 0==n?0:n;for(var i=0,o=t.length;i<o;i++){if("object"==typeof t[i])return n++,this.totalChars(t[i],e,n);e+=t[i].toString().length}return e},ObjectExt.prototype.totalKeys=function(t){var e=0;for(var n in t)t.hasOwnProperty(n)&&e++;return e},ObjectExt.prototype.wrap=function(t,e,n){n=void 0==n?e:n;for(var i=[],o=0,r=t.length;o<r;o++)i[o]=e.toString()+t[o]+n.toString();return i},ObjectExt.prototype.clone=function(t){if(null==t||"_object"!=typeof t)return t;if(t instanceof Date)return(e=new Date).setTime(t.getTime()),e;if(t instanceof Array){for(var e=[],n=0,i=t.length;n<i;n++)e[n]=this.clone(t[n]);return e}if(t instanceof Object){e={};for(var o in t)t.hasOwnProperty(o)&&(e[o]=this.clone(t[o]));return e}throw new Error("Unable to copy obj! Its type isn't supported.")},ObjectExt.prototype.byString=function(t,e){if(void 0==e)return t;for(var n=(e=(e=e.replace(/\[['|"]*(\w+)['|"]*\]/g,".$1")).replace(/^\./,"")).split(".");n.length;){var i=n.shift();if(!(i in t))return;t=t[i]}return t},Culuh.prototype.reset=function(){var t=this.original;if((t=t.toUpperCase()).indexOf("RGB")>-1){var e=t.match(/\d+\.?\d*/g);this.r=parseInt(e[0]),this.g=parseInt(e[1]),this.b=parseInt(e[2])}else{e=t.match(/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i);this.r=this.hexToInt(e[1]),this.g=this.hexToInt(e[2]),this.b=this.hexToInt(e[3])}},Culuh.prototype.hsvUpdate=function(){var t,e,n,i=this.r/255,o=this.g/255,r=this.b/255,a=Math.min(i,o,r),s=Math.max(i,o,r),u=s-a;n=s,0==(e=0==s?0:u/s)?t=0:(t=i==s?(o-r)/u:o==s?2+(r-i)/u:4+(i-o)/u,isNaN(t)&&(t=0),(t/=6)<0&&t++),this.h=255*t,this.s=255*e,this.v=255*n},Culuh.prototype.rgbUpdate=function(){var t,e,n,i=this.h/255,o=this.s/255,r=this.v/255;if(0==o)t=e=n=r;else{var a=(i*=6)%1,s=r*(1-o),u=r*(1-o*a),c=r*(1-o*(1-a));switch(Math.floor(i)){case 0:t=r,e=c,n=s;break;case 1:t=u,e=r,n=s;break;case 2:t=s,e=r,n=c;break;case 3:t=s,e=u,n=r;break;case 4:t=c,e=s,n=r;break;case 5:t=r,e=s,n=u}}this.r=parseInt(255*t),this.g=parseInt(255*e),this.b=parseInt(255*n)},Culuh.prototype.hex=function(t){return(t=void 0==t?"":t)+this.rHex()+this.gHex()+this.bHex()},Culuh.prototype.rgb=function(){return"rgb("+this.r+","+this.g+","+this.b+")"},Culuh.prototype.rHex=function(){return this.intToHex(this.r)},Culuh.prototype.gHex=function(){return this.intToHex(this.g)},Culuh.prototype.bHex=function(){return this.intToHex(this.b)},Culuh.prototype.rInt=function(){return this.r},Culuh.prototype.gInt=function(){return this.g},Culuh.prototype.bInt=function(){return this.b},Culuh.prototype.hexToInt=function(t){return parseInt(t,16)},Culuh.prototype.intToHex=function(t){var e=t.toString(16);return e.length<2&&(e="0"+e),e.toUpperCase()},Culuh.prototype.sat=function(t,e){var n=this.s;if(n*=t,1==e){var i=new Culuh(this.rgb());return i.sat(t),i}this.s=n,this.rgbUpdate()},Culuh.prototype.toAlpha=function(t){return t=(t=(t=parseFloat(t))<0?0:t)>1?1:t,"rgba("+this.r+","+this.g+","+this.b+","+t+")"},Culuh.prototype.invert=function(t){if(1==t){var e=new Culuh(this.rgb());return e.invert(),e}this.r=255-this.r,this.g=255-this.g,this.b=255-this.b,this.hsvUpdate()},function(t){function e(t,e,n){this.elem=t,this.id=n,this.init(t,e)}e.prototype.init=function(e,n){var i=this;i.options=t.extend({closed:"&#9660;",open:"&#9650;",button_classes:null,up:!1,cover:!1},n),i.events={open:"MENUMUCIL-OPEN",closed:"MENUMUCIL-CLOSED"},i.menu=null,i.pane=null,i.clicker=null,i.build()},e.prototype.build=function(){var e=this;if(e.menu=t(e.elem),e.menu.addClass("menumucil"),(e.options.cover||e.options.up)&&e.menu.css({position:"absolute","z-index":5e3}),e.menu.wrapInner('<div class="inner" />'),e.menu.wrapInner('<div class="pane" />'),e.pane=t(".pane",e.elem),e.pane.addClass("closed"),e.clicker=t(document.createElement("a")),e.clicker.attr("href","#"),e.clicker.addClass("clicker"),null!=e.options.button_classes&&e.clicker.addClass(e.options.button_classes),e.menu.append(e.clicker),e.icon=t(document.createElement("span")),e.icon.addClass("icon"),e.clicker.append(e.icon),e.icon.html(e.options.closed),e.extra=t(document.createElement("span")),e.extra.addClass("extra"),e.clicker.append(e.extra),e.pane.on("transitionEnd webkitTransitionEnd transitionend oTransitionEnd msTransitionEnd",function(t){e.pane.hasClass("open")&&e.pane.css("max-height",9999)}),e.options.cover||e.options.up){var n=e.clicker.height();e.menu.after('<div style="height:'+n+'px;clear:both"></div>')}e.closeNow(),t(e.clicker).on("click touchstart",function(t){e.isOpen()?e.close():e.pane.hasClass("closed")&&e.open(),t.preventDefault()})},e.prototype.isOpen=function(){return!!this.pane.hasClass("open")},e.prototype.isClosed=function(){return!!this.pane.hasClass("closed")},e.prototype.open=function(){var e=this;e.pane.contentHeight=e.pane.outerHeight(),e.pane.contentHeight+=t(".inner",e.elem).outerHeight(),e.pane.css({"max-height":e.pane.contentHeight}),e.options.up&&e.menu.css({top:e.menu.position().top-e.pane.contentHeight}),e.pane.removeClass("closed"),e.pane.addClass("open"),e.icon.html(e.options.open),e.pane.trigger(e.events.open,[e.id])},e.prototype.close=function(){var t=this;t.pane.contentHeight=t.pane.outerHeight(),t.pane.removeClass("transitions").css("max-height",t.pane.contentHeight),setTimeout(function(){t.closeNow(),t.pane.removeClass("open"),t.pane.addClass("closed"),t.icon.html(t.options.closed),t.menu.trigger(t.events.closed,[t.id])},10)},e.prototype.closeNow=function(){this.pane.addClass("transitions").css({"max-height":0})},jQuery(document).ready(function(t){jQuery.fn.menumucil=function(t){var n=jQuery(this).selector;return this.each(function(){jQuery.data(this,n,new e(this,t,n))})}})}(jQuery),Sorted.prototype.areaSort=function(t,e,n,i,o,r){var a=new ObjectExt;if(o=void 0==o?[]:o,r=void 0==r?0:r,e=void 0==e?"x":e,n=void 0==n?"y1":n,i=void 0==i?"y2":i,o.length-1<r&&(o[r]=[]),"object"!=typeof t[0])throw"Sorted.areaSort() -- First parameter must be an array of objects";for(var s=0,u=parseInt(a.byString(t[s],n)),c=1,l=t.length;c<l;c++){(m=parseInt(a.byString(t[c],n)))<u&&(u=m,s=c)}var h=t.splice(s,1);h=h[0],o[r].push(h);var p=parseInt(a.byString(h,n)),d=parseInt(a.byString(h,i));for(c=t.length;c--;){var m,f=parseInt(a.byString(t[c],n));if((m=f+(parseInt(a.byString(t[c],i))-f)/2)>=p&&m<=d){var g=t.splice(c,1);g=g[0],o[r].push(g)}}if(0==t.length){for(c=0,l=o.length;c<l;c++)o[c]=this.numSort(o[c],e);return o}return r+=1,this.areaSort(t,e,n,i,o,r)},Sorted.prototype.numSort=function(t,e){var n=new ObjectExt;return t.sort(function(t,i){return Number(n.byString(t,e))-Number(n.byString(i,e))})},function(t){function e(t,e,n){this.elem=t,this.id=n,this.init(t,e)}e.prototype.init=function(t,e){this.elem=t,this.options=jQuery.extend({button:"close"},e),this.obj={id:null,HIDDEN:"-9999px"},this.create()},e.prototype.position=function(){var e=(t(window).width()-t(this.elem).width())/2,n=(t(window).height()-t(this.elem).height())/2;t(this.elem).css({display:"block",position:"absolute","z-index":"9999",top:n+"px",left:e+"px"})},e.prototype.popup=function(){var e=this;e.position(),t(document).trigger("PLOPUP-POPPED",e.obj.id),t(window).resize(function(){"block"==t(e.elem).css("display")&&t(e.elem).css("top")!=e.obj.HIDDEN&&e.position()})},e.prototype.hide=function(){t(this.elem).css({top:this.obj.HIDDEN})},e.prototype.create=function(){var e=this;e.obj.id=t(e.elem).attr("id"),t(e.elem).css({display:"none"});var n=t(document.createElement("div"));n.css({clear:"both"}),t(e.elem).prepend(n);var i=t(document.createElement("a"));i.html(e.options.button),i.attr("href","#"+e.obj.id+"-close"),i.addClass("plopup"),i.addClass("close"),t(e.elem).prepend(i),i.css({clear:"both"}),i.click(function(t){e.hide(),t.preventDefault()}),t(document).bind("PLOPUP-POPPED",function(n,i){i!=e.obj.id&&"block"==t(e.elem).css("display")&&t(e.elem).css("top")!=e.obj.HIDDEN&&t(e.elem).css({top:e.obj.HIDDEN})}),t("a",document).click(function(n){var i=t(this).attr("href");void 0!=i&&(i=i.replace("#",""))==e.obj.id&&(e.popup(),n.preventDefault())})},jQuery(document).ready(function(t){jQuery.fn.plopup=function(t){var n=jQuery(this).selector;return this.each(function(){jQuery.data(this,n,new e(this,t,n))})}})}(jQuery);var PerseidsBridge=PerseidsBridge||{REVISION:"1"};PerseidsBridge.imgspect=function(){var t;return{init:function(){return t||(t=function(){var t=this;return t.imgspect=null,t.output=null,t.warning=null,t.img=null,t.w_tags={},t.load=function(e){if(e=void 0!=e&&e,null!=t.imgspect&&0==e)return t.buildWarning(),void t.warning.popup();t.buildWait(),t.warning.popup(),$(".imgUrn").removeClass("selected"),$('.imgUrn[rel="'+t.img.src+'"]').addClass("selected"),$("#imgspect").empty(),$("#imgspect").append(t.img),t.imgspect=$("#imgspect img").imgspect().data("#imgspect img"),t.urn=t.getUrn(),$("#ict_tool").addClass("imgspectLoaded"),$(t.imgspect.elem).on("IMGSPECT-UPDATE",function(){var e=t.buildTags();$(".imgspect .output").val(e.join("\n\n"))})},t.buildTags=function(){for(var e=[],n=0,i=t.imgspect.imgbits.length;n<i;n++){var o=t.urnCoords(n),r=t.imgspect.imgbits[n].caption;e[n]='<w facs="'+o+'">'+r+"</w>"}return e},t.urnCoords=function(e){var n=t.imgspect.imgbits[e].citeCoords();return t.urn+"@"+n.join(",")},t.buildWarning=function(){$("#imgspectWarning").remove(),$("body").append('\t\t\t\t<div id="imgspectWarning">\t\t\t\t\t<p>\t\t\t\t\t\tSwitching images will reset imgspect. \t\t\t\t\t</p>\t\t\t\t\t<p>\t\t\t\t\t\tYou will lose your highlights and captions \t\t\t\t\t\tif you have have not copied them to your main XML document.\t\t\t\t\t</p>\t\t\t\t\t<p>\t\t\t\t\t\tDo you want to CONTINUE?\t\t\t\t\t</p>\t\t\t\t\t<div id="imgspectButtons">\t\t\t\t\t\t<a id="imgspectWarningOk" href="">CONTINUE</a>\t\t\t\t\t\t<a id="imgspectWarningCancel" href="">CANCEL</a>\t\t\t\t\t</div>\t\t\t\t</div>'),t.warning=$("#imgspectWarning").plopup({button:"x"}).data("#imgspectWarning"),$("#imgspectWarningOk").click(function(e){t.load(!0),e.preventDefault()}),$("#imgspectWarningCancel").click(function(e){t.warning.hide(),e.preventDefault()})},t.buildWait=function(){$("#imgspectWarning").remove(),$("body").append('\t\t\t\t<div id="imgspectWarning">\t\t\t\t\t<p>\t\t\t\t\t\tLoading hi-res image.\t\t\t\t\t</p>\t\t\t\t\t<p>\t\t\t\t\t\tThis may take a while.\t\t\t\t\t</p>\t\t\t\t\t<div class="space"><img src="/javascripts/imgspect/src/img/ajax-loader.gif" /></div>\t\t\t\t</div>'),t.warning=$("#imgspectWarning").plopup({button:"x"}).data("#imgspectWarning"),$(document).on("IMGSPECT-READY",function(){$("#imgspectWarning").remove()})},t.getUrn=function(){return t.imgspect.src.params().urn},t.getTags=function(t){var e=this,n=$.parseXML(t.smoosh());$(n).find("w").each(function(){var t=this.innerHTML,n=$(this).attr("facs").split("@"),i=n[0],o=n[1].split(",");i in e.w_tags||(e.w_tags[i]=[]),e.w_tags[i].push({caption:t,coords:o})})},t.clickListen=function(t){var e=this;$("#"+t).click(function(t){t.preventDefault();var n=$(this).attr("href");null!=e.imgspect&&e.imgspect.src==n||(e.img=new Image,e.img.onload=function(){e.load()},e.img.src=n)})},t.loadTags=function(){var t=this;if(void 0==t.w_tags||t.imgspect.src in t.w_tags){for(var e=t.imgspect.src,n=t.imgspect.orig_w,i=t.imgspect.orig_h,o=0,r=t.w_tags[e].length;o<r;o++){var a=t.w_tags[e][o].coords,s=Math.floor(a[0]*n),u=Math.floor(a[1]*i),c=Math.floor(a[2]*n)+s,l=Math.floor(a[3]*i)+u;t.imgspect.liteAdd(s,u,c,l),t.imgspect.imgbits[o].setCaption(t.w_tags[e][o].caption)}t.imgspect.resize()}},{imgspect:t.imgspect,w_tags:t.w_tags,buildLinks:function(e,n){for(var i="http://services.perseus.tufts.edu/sparqlimg/api?request=GetBinaryImage&urn=",o=0,r=n.length;o<r;o++){var a='<a id="imgUrn_'+o+'"class="imgUrn" href="'+i+n[o]+'&w=3000"><img src="'+i+n[o]+'&w=100"/></a>';jQuery(e).append(a),t.clickListen(a.attr("id"))}},getTags:t.getTags,buildTags:t.buildTags,loadTags:t.loadTags,load:t.load,clickListen:t.clickListen,start:function(){$(document).on("IMGSPECT-LINK_LOADED",function(e,n){t.clickListen(n)})}}}()),t}}}(),function(t){function e(t,e,n){this.elem=t,this.id=n,this.init(t,e)}e.prototype.init=function(e,n){var i=this;i.options=t.extend({style:"full",closable:!1},n),i.events={change:"IMGBIT-CHANGE",closed:"IMGBIT-CLOSED",frame:"IMGBIT-FRAME"},i.original=t(i.elem).myHtml(),i.href=t(i.elem).attr("href"),i.caption=t(i.elem).text(),i.imgWidth=null,i.imgHeight=null;var o=new TimeStamp;i.timeCreated=o.withUtc(!0);var r=i.href.split("imgbit=");i.src=i.href,i.param={},r.length>1&&(i.src=r[0].substring(0,r[0].length-1),i.param=i.getToJson(r[1])),i.specClass(),i.build()},e.prototype.specClass=function(){var e=this;t(e.elem).hasClass("min")&&(e.options.style=null),t(e.elem).hasClass("edit")&&(e.options.style="edit"),t(e.elem).hasClass("closable")&&(e.options.closable=!0)},e.prototype.fixParams=function(){var t=this;void 0!=t.param.w&&(t.param.z=t.param.w/(t.param.x2-t.param.x1)),void 0!=t.param.h&&(t.param.z=t.param.h/(t.param.y2-t.param.y1)),void 0!=t.param.c&&(t.culuh=new Culuh(t.param.c)),t.param.z=void 0==t.param.z?1:t.param.z},e.prototype.build=function(){var e=this,n=t(e.elem).attr("id");t(e.elem).after('<div class="imgbit">'),e.elem=t(e.elem).next(),t(e.elem).attr("id",n);var i=t(e.elem).prev(),o=i.html();i.remove(),null!=e.options.style&&t(e.elem).addClass(e.options.style),t(e.elem).append('<div class="view">'),t(e.elem).append('<div class="text">'+o+"</div>"),t(".text",e.elem).hide(),null!=e.options.style&&t(".text",e.elem).show();var r=new Image;r.onload=function(){t(this).addClass("star"),e.imgWidth=r.width,e.imgHeight=r.height,e.toExplicit(),e.fixParams(),t(".view",e.elem).append(this),e.viewCrop(),e.imgMove(),t(e.elem).prepend('<div style="clear:both"></div>'),null!=e.options.style&&"edit"!=e.options.style&&t(e.elem).prepend('<a class="source" href="'+e.src+'">source</a>'),t(e.elem).css({width:t(".view",e.elem).width()}),e.editStart(),1==e.options.closable&&e.closeBuild(),void 0!=e.param.c&&(t(e.elem).css({"background-color":"#"+e.param.c}),t(".close",e.elem).css({"background-color":"#"+e.param.c})),t(e.elem).trigger(e.events.change)},r.src=e.src},e.prototype.closeBuild=function(){var e=this;t(e.elem).prepend('<a href="" class="close">x</a>'),t(".close",e.elem).click(function(n){t(e.elem).trigger(e.events.closed),t(e.elem).trigger(e.events.change),n.preventDefault()})},e.prototype.captionResize=function(){var e=t(".text",this.elem),n=!1;0==e.is(":visible")&&(n=!0),e.show();var i=e.height();1==n&&e.hide();var o=parseInt(e.css("font-size").replace("px","")),r=i>o?i:o;t(".caption",this.elem).height(r)},e.prototype.editStart=function(){var e=this;"edit"==e.options.style&&(e.editBuild(),e.captionResize(),t(".caption",e.elem).keypress(function(t){13==t.which&&e.editSwitch()}),t(".caption",e.elem).bind("input propertychange",function(){e.setCaption(t(".caption",e.elem).val())}))},e.prototype.remove=function(){t(this.elem).remove()},e.prototype.setCaption=function(e){var n=this;n.caption=e,t(".text",n.elem).text(n.caption),n.captionResize(),t(n.elem).trigger(n.events.change)},e.prototype.idUpdate=function(e){t(this.elem).attr("id",e)},e.prototype.editBuild=function(){var e=this,n='<textarea class="caption">'+t(".text",e.elem).text()+"</textarea>";t(".text",e.elem).after(n),t(".caption",e.elem).css({width:t(".view",e.elem).width()}),void 0!=e.culuh&&t(".caption",e.elem).css({"background-color":e.culuh.sat(.35,!0).hex()}),t(".caption",e.elem).hide(),t(".text",e.elem).on("touchstart click",function(t){t.preventDefault(),e.editSwitch()}),t(document).on("touchstart click",function(n){t(n.target).html()!=t(".caption",e.elem).html()&&t(n.target).html()!=t(".text",e.elem).html()&&e.editHide()})},e.prototype.editSwitch=function(){t(".caption",this.elem).is(":visible")?this.editHide():(e.prototype.editHide(),this.editShow())},e.prototype.editHide=function(){t(".caption",this.elem).hide(),t(".text",this.elem).show()},e.prototype.editShow=function(){t(".text",this.elem).hide(),t(".caption",this.elem).show(),t(".caption",this.elem).cursorToEnd()},e.prototype.viewCrop=function(){var e=this;t(".view",e.elem).css({width:(e.param.x2-e.param.x1)*e.param.z,height:(e.param.y2-e.param.y1)*e.param.z}),t(e.elem).css({width:(e.param.x2-e.param.x1)*e.param.z})},e.prototype.imgMove=function(){var e=this;t("img.star",e.elem).css({width:e.imgWidth*e.param.z,height:e.imgHeight*e.param.z,left:-1*e.param.x1*e.param.z,top:-1*e.param.y1*e.param.z})},e.prototype.sequence=function(e,n,i){var o=this;if(i=void 0!=i?i:0,n=void 0!=n&&n,e.length<=i)1==n&&o.sequence(e,n,0);else{o.param.x1=e[i].coords[0],o.param.y1=e[i].coords[1],o.param.x2=e[i].coords[2]+o.param.x1,o.param.y2=e[i].coords[3]+o.param.y1,o.param.z=e[i].coords[4];var r=void 0==e[i].wipe?1:e[i].wipe,a=void 0==e[i].stay?5:e[i].stay;t("img.star, .view",o.elem).css({transition:"all "+r+"s","-webkit-transition":"all "+r+"s"}),t(o.elem).css({transition:"all "+r+"s","-webkit-transition":"all "+r+"s"}),o.imgMove(),o.viewCrop(),t(".caption",o.elem).hide();var s=null;"caption"in e[i]&&(s=e[i].caption,"min"==o.options.style&&null==o.options.style||(t(".caption",o.elem).show(),o.setCaption(s))),i++,setTimeout(function(){o.sequence(e,n,i)},1e3*(a+r)),t(o.elem).trigger(o.events.frame,{caption:s})}},e.prototype.getToJson=function(t){if(""==t||void 0==t)return{};for(var e={},n=t.split("%"),i=0,o=n.length;i<o;i++){var r=n[i].split("=");2==r.length&&(e[r[0]]=decodeURIComponent(r[1].replace(/\+/g,"")))}return e},e.prototype.html=function(){var t=this,e=-1==t.src.indexOf("?")?"?":"&";return('<a class="imgbit" \t\t\t\t\t\thref="'+t.src+"\t\t\t\t\t\t"+e+"imgbit=\t\t\t\t\t\tx1="+t.param.x1+"\t\t\t\t\t\t%y1="+t.param.y1+"\t\t\t\t\t\t%x2="+t.param.x2+"\t\t\t\t\t\t%y2="+t.param.y2+"\t\t\t\t\t\t%c="+t.param.c+"\t\t\t\t\t\t%z="+t.param.z+'">\t\t\t\t\t\t'+t.caption+"\t\t\t\t\t<a>").smoosh()},e.prototype.sequenceFormat=function(){var t=this;return{coords:[parseInt(t.param.x1),parseInt(t.param.y1),parseInt(t.param.x2)-parseInt(t.param.x1),parseInt(t.param.y2)-parseInt(t.param.y1),t.param.z],caption:t.caption}},e.prototype.relative=function(){return this.citeCoords()},e.prototype.citeCoords=function(){var t=this,e=[];e[0]=t.param.x1/t.imgWidth,e[1]=t.param.y1/t.imgHeight,e[2]=(t.param.x2-t.param.x1)/t.imgWidth,e[3]=(t.param.y2-t.param.y1)/t.imgHeight;for(var n=0,i=e.length;n<i;n++)e[n]=e[n].toFixed(4);return e},e.prototype.toExplicit=function(){var t=this;t.param.w<=1&&t.param.h<=1&&t.param.x<=1&&t.param.y<=1&&(t.param.x1=t.param.x*t.imgWidth,t.param.y1=t.param.y*t.imgHeight,t.param.x2=t.param.x1+t.param.w*t.imgWidth,t.param.y2=t.param.y1+t.param.h*t.imgHeight,delete t.param.x,delete t.param.y,delete t.param.w,delete t.param.h)},e.prototype.toJsonLD=function(t){return{"@context":"http://www.w3.org/ns/oa-context-20130208.json","@type":"oa:Annotation",annotatedAt:this.timeCreated,annotatedBy:{"@type":"foaf:Person"},motivatedBy:"perseus:transcribing",label:"isQuotationOf"}},jQuery(document).ready(function(t){jQuery.fn.imgbit=function(t){var n=jQuery(this).selector;return this.each(function(){jQuery.data(this,n,new e(this,t,n))})}})}(jQuery),function(t){function e(t,e,n){this.elem=t,this.id=n,this.init(t,e)}e.prototype.init=function(e,n){var i=this;i.colors={YELLOW:"#FFFF00",MAGENTA:"#FF00FF",CYAN:"#00FFFF"},i.options=t.extend({zoom_unit:.1,lite_color:new Culuh(i.colors.YELLOW),lite_opacity:.4,secs:.5,load:null,info:null},n),i.events={change:"IMGSPECT-CHANGE",undo:"IMGSPECT-UNDO",error:"IMGSPECT-ERROR",update:"IMGSPECT-UPDATE",ready:"IMGSPECT-READY"},i.lites=[],i.imgbits=[],i.zoom_n=1,i.zoom_shift=null,i.pan={x:0,y:0},i.c_lite=null,i.orig_w=t(i.elem).width(),i.orig_h=t(i.elem).height(),i.nav_scale=1,i.dragDiff={top:0,left:0},i.src=null,i.build(),i.resize(),i.outputBuild(),i.start(),t(i.elem).trigger(i.events.ready)},e.prototype.toJsonLD=function(){for(var t=[],e=0,n=this.imgbits.length;e<n;e++)t[e]=this.imgbits[e].toJsonLD(this.options.info);return t},e.prototype.dump=function(){console.log(this)},e.prototype.build=function(){var e=this;t(e.elem).wrap('<div class="imgspect">'),e.elem=t(e.elem).parent(),t("img",e.elem).wrap('<div class="nav">'),t(".nav",e.elem).prepend('<div class="drag">'),t(".nav",e.elem).wrap('<div class="ui">'),t(".ui",e.elem).wrap('<div class="center">'),t(e.elem).prepend('<div class="view">'),t(".view",e.elem).prepend('<div class="draw">'),e.src=t(".nav img",e.elem).attr("src"),t(".draw",e.elem).css({"background-image":"url('"+e.src+"')"}),e.toolsBuild(),e.dropBuild(),t(e.elem).append('<div style="clear:both">')},e.prototype.toolsBuild=function(){var e=this;t(".ui",e.elem).append('<div class="tools">'),t(".tools",e.elem).append('\t\t\t<a href="#" class="tool zoom in">+</a>\t\t\t<a href="#" class="tool zoom out">-</a>\t\t'),t(".tools",e.elem).append('<div class="colors">');for(var n in e.colors){var i=n.toLowerCase();t(".colors",e.elem).append('<a href="#" class="tool color '+i+'">&nbsp;<a>'),t(".color."+i,e.elem).css({"background-color":e.colors[n]})}t(".tools",e.elem).append('<a href="#" class="tool undo">&larr;</a>'),t(".tools",e.elem).append('<div style="clear:both">')},e.prototype.dropBuild=function(){t(this.elem).before('\t\t\t<div id="drop">\t\t\t\t<div class="sortBits">\t\t\t\t\t<a href="" id="time" class="sort">Time</a>\t\t\t\t\t<a href="" id="space" class="sort">Space</a>\t\t\t\t</div>\t\t\t\t<div class="imgbits"></div>\t\t\t</div>'.smoosh()),t("#drop .sortBits").hide(),this.drop=t("#drop").menumucil({cover:!0,closed:"&#9660",open:"&#9650"}).data("#drop"),this.dropStart()},e.prototype.dropCount=function(){var e=this.lites.length;t("#drop .extra").text(e)},e.prototype.dropStart=function(){var e=this;t(e.elem).on(e.events.change,function(t){var n=e.liteLast().id;e.imgbitAdd(n),e.dropCount()}),t("#drop .sort").on("touchstart click",function(n){n.stopPropagatin(),n.preventDefault();var i=t(this).attr("id");e.imgbitsSort(i)})},e.prototype.imgbitAdd=function(e){var n=this.liteToImgbit(e);t("#drop .imgbits").append(n);var i="#drop #imgbit-"+e;this.imgbits.push(t(i).imgbit().data(i)),this.imgbitStart(e)},e.prototype.imgbitsSort=function(t){t=void 0==t?"time":t;var e=new TimeStamp;switch(t){case"time":for(var n=0,i=this.imgbits.length;n<i;n++){var o=this.imgbits[n].timeCreated;e.toUnix(o)}break;case"space":(new Sorted).areaSort(this.imgbits,"param.x1","param.y1","param.y2")}},e.prototype.imgbitRemove=function(e,n){var i=this;try{if(e<0||e>=i.imgbits.length)throw"out of range"}catch(e){return void t(i.elem).trigger(i.events.error,{error:e})}i.imgbits[e].remove();i.imgbits.splice(e,1);for(var o=0,r=i.imgbits.length;o<r;o++)i.imgbits[o].idUpdate("imgbit-"+o),i.imgbits[o].elem.off("IMGBIT-CHANGE"),i.imgbits[o].elem.off("IMGBIT-CLOSED"),i.imgbitStart(o);i.dropCount()},e.prototype.imgbitStart=function(e){var n=this;t("#drop #imgbit-"+e+" .view").on("touchstart click",function(e){e.stopPropagation(),e.preventDefault(),n.drop.close();var i=t(this).parent().attr("id"),o=parseInt(i.replace("imgbit-",""));setTimeout(function(){n.liteShow(o)},500)}),t("#drop #imgbit-"+e).on("IMGBIT-CHANGE",function(){n.outputUpdate()}),t("#drop #imgbit-"+e).on("IMGBIT-CLOSED",function(){n.liteRemove(e)})},e.prototype.outputBuild=function(){var e=this;t(".tools",e.elem).append('<textarea readonly="readonly" id="imgspectOut" class="output"></textarea>'),t(".output",e.elem).css({"max-height":t(".nav",e.elem).innerHeight()-t(".tool",e.elem).outerHeight()}),e.outputInitText()},e.prototype.outputInitText=function(){t(".output",this.elem).val("WELCOME TO IMGSPECT \n------------------- \nImgspect is a tool for captioning or transcribing select areas of large images.\n\nUnique identifiers for your captioned areas will be written to this output window once you begin. \n\n\nHOW TO USE IMGSPECT \n------------------- \nDrag the see-through white rectangle over the area of the smaller image you want to inspect. \n\nClick and drag your mouse over the larger image to highlight areas you're interested in. \n\nClick the color squares to change the highlight color. \n\nClick the plus and minus buttons to zoom the larger image in and out. \n\nClick the back-arrow to remove the last highlight. \n\nClick the triangle to open a drop-down of just your highlighted areas. \n\nIn the drop-down view click the hash tag to caption or transcribe the highlighted area.\n\nIn the drop-down view click an img to find its original position in the larger image.\n\n".trim())},e.prototype.outputUpdate=function(){var e=this;t(".output",e.elem).val("");for(var n="",i=0,o=e.imgbits.length;i<o;i++)n+=e.imgbits[i].html()+"\n";t(".output",e.elem).val(n),t(e.elem).trigger(e.events.update)},e.prototype.outputSequence=function(){t(".output",this.elem).val("");for(var e=[],n=0,i=this.imgbits.length;n<i;n++)e[n]=this.imgbits[n].sequenceFormat();t(".output",this.elem).val(JSON.stringify(e))},e.prototype.resize=function(){var t=this;t.navResize(),t.viewResize(),t.drawResize(),t.dragResize(),t.liteResize()},e.prototype.dragNavDiff=function(){var e=this,n=t(".nav .drag",e.elem).offset().left,i=t(".nav",e.elem).offset().left,o=t(".nav .drag",e.elem).offset().top,r=t(".nav",e.elem).offset().top;e.dragDiff.left=n-i,e.dragDiff.top=o-r},e.prototype.start=function(){var t=this;t.zoomStart(),t.undoStart(),t.liteStart(),t.dragStart(),t.scrollStart(),t.sizeStart(),t.colorStart()},e.prototype.colorStart=function(){var e=this;t(".color:first",e.elem).addClass("selected"),t(".color",e.elem).on("touchstart click",function(n){n.stopPropagation(),n.preventDefault(),t(".color",e.elem).removeClass("selected"),t(this).addClass("selected"),e.liteColor(t(this).css("background-color"))})},e.prototype.undoStart=function(){var e=this;t(".undo",e.elem).on("touchstart click",function(t){t.stopPropagation(),t.preventDefault();var n=e.lites.length-1;e.liteRemove(n)})},e.prototype.liteRemove=function(e){var n=this;try{if(e<0||e>=n.imgbits.length)throw"out of range"}catch(e){return void t(n.elem).trigger(n.events.error,{error:e})}var i=n.lites.splice(e,1);n.imgbitRemove(e),n.liteRedraw(),t(".nav .lite:eq("+e+")",n.elem).remove(),t(n.elem).trigger(n.events.undo,{id:i.id}),n.outputUpdate()},e.prototype.sizeStart=function(){var e,n=this;t(window).resize(function(){e&&clearTimeout(e),e=setTimeout(function(){n.resize()},10)})},e.prototype.drawMouseDown=function(e){var n=this;n.c_lite=t(document.createElement("div")).addClass("lite"),t(".draw",n.elem).append(n.c_lite);var i=n.viewMousePos(e),o=t(".draw",n.elem).position();n.c_pos={left:i.left-o.left,top:i.top-o.top},n.c_lite.css({left:n.c_pos.left,top:n.c_pos.top,"background-color":"#"+n.options.lite_color.hex(),opacity:n.options.lite_opacity})},e.prototype.drawMouseMove=function(e){var n=this;if(null!=n.c_lite){var i=n.c_pos,o=n.viewMousePos(e),r=t(".draw",n.elem).position();o.left-=r.left,o.top-=r.top,i.left>o.left?n.c_lite.css({left:o.left,width:i.left-o.left}):n.c_lite.css({left:i.left,width:o.left-i.left}),i.top>o.top?n.c_lite.css({top:o.top,height:i.top-o.top}):n.c_lite.css({top:i.top,height:o.top-i.top})}},e.prototype.drawMouseUp=function(t){var e=this;if(null!=e.c_lite)if(0!=e.c_lite.width()&&0!=e.c_lite.height()){var n=e.c_lite.position(),i=n.left/e.zoom_n,o=n.top/e.zoom_n,r=i+e.c_lite.width()/e.zoom_n,a=o+e.c_lite.height()/e.zoom_n;e.liteAdd(i,o,r,a)}else e.c_lite=null},e.prototype.liteStart=function(){var e=this;t(".view",e.elem).mousedown(function(t){t.preventDefault(),e.drawMouseDown(t)}),t(".view",e.elem).bind("touchstart",function(t){t.preventDefault(),e.drawMouseDown(t)}),t(".view",e.elem).mousemove(function(t){t.preventDefault(),e.drawMouseMove(t)}),t(".view",e.elem).bind("touchmove",function(t){t.preventDefault(),e.drawMouseMove(t)}),t(e.elem).mouseup(function(t){t.preventDefault(),e.drawMouseUp(t)}),t(e.elem).bind("touchend",function(t){t.preventDefault(),e.drawMouseUp(t)})},e.prototype.liteAdd=function(e,n,i,o){var r=this;r.lites.push({x1:parseInt(e),y1:parseInt(n),x2:parseInt(i),y2:parseInt(o),zoom:r.zoom_n,color:r.options.lite_color,opacity:r.options.lite_opacity,id:r.lites.length}),r.navLiteDraw(r.liteLast().id),r.c_lite=null,r.c_pos=null,t(r.elem).trigger(r.events.change)},e.prototype.liteDom=function(){return t(document.createElement("div")).addClass("lite")},e.prototype.navLiteDraw=function(e){var n=this;try{if(e<0||e>=n.lites.length)throw"out of range"}catch(e){return void t(n.elem).trigger(n.events.error,{error:e})}var i=n.liteDom(),o=t(".nav",n.elem);o.append(i);var r=o.position(),a=n.lites[e];i.css({left:a.x1/n.nav_scale+r.left,top:a.y1/n.nav_scale+r.top,width:a.x2/n.nav_scale-a.x1/n.nav_scale,height:a.y2/n.nav_scale-a.y1/n.nav_scale,"background-color":"#"+a.color.hex(),opacity:a.opacity})},e.prototype.liteLast=function(){return this.lites[this.lites.length-1]},e.prototype.liteResize=function(){this.liteRedraw()},e.prototype.liteShow=function(e){var n=this;try{if(e<0||e>=n.lites.length)throw"out of range"}catch(e){return void t(n.elem).trigger(n.events.error,{error:e})}var i=n.lites[e],o=i.x1+(i.x2-i.x1)/2,r=i.y1+(i.y2-i.y1)/2;o-=t(".view",n.elem).width()/2/n.zoom_n,r-=t(".view",n.elem).height()/2/n.zoom_n,n.goTo(o,r)},e.prototype.liteRedraw=function(){var e=this;t(".draw .lite",e.elem).remove();t(".draw",e.elem).position();for(var n=0,i=e.lites.length;n<i;n++){var o=e.liteDom();t(".draw").append(o),o.css({left:e.lites[n].x1*e.zoom_n,top:e.lites[n].y1*e.zoom_n,width:(e.lites[n].x2-e.lites[n].x1)*e.zoom_n,height:(e.lites[n].y2-e.lites[n].y1)*e.zoom_n,"background-color":"#"+e.lites[n].color.hex(),opacity:e.lites[n].opacity})}},e.prototype.navLiteClear=function(){t(".nav .lite",this.elem).remove()},e.prototype.navLiteRedraw=function(){this.navLiteClear();for(var t=0,e=this.lites.length;t<e;t++)this.navLiteDraw(t)},e.prototype.liteColor=function(t){(t=t.toUpperCase())in this.colors?this.options.lite_color=new Culuh(this.colors[t]):this.options.lite_color=new Culuh(t)},e.prototype.liteToImgbit=function(e){var n=this;try{if(e<0||e>=n.lites.length)throw"out of range"}catch(e){return void t(n.elem).trigger(n.events.error,{error:e})}var i=n.lites[e],o=i.color,r=-1==n.src.indexOf("?")?"?":"&";return('<a id="imgbit-'+e+'" class="imgbit edit closable" href="'+n.src+"\t\t\t\t"+r+"imgbit=\t\t\t\tx1="+i.x1+"\t\t\t\t%y1="+i.y1+"\t\t\t\t%x2="+i.x2+"\t\t\t\t%y2="+i.y2+"\t\t\t\t%z="+i.zoom+"\t\t\t\t%c="+o.sat(.5,!0).hex()+'\t\t\t\t">#</a>').smoosh()},e.prototype.zoomStart=function(){var e=this;t(".zoom",e.elem).on("touchstart click",function(n){n.stopPropagation(),n.preventDefault(),t(this).hasClass("in")?e.zoomIn():e.zoomOut()})},e.prototype.zoomIn=function(){this.zoom("IN")},e.prototype.zoomOut=function(){this.zoom("OUT")},e.prototype.zoom=function(e){var n=this,i=n.zoom_n;switch(e.toUpperCase()){case"IN":n.zoom_n+=n.options.zoom_unit;break;case"OUT":n.zoom_n-=n.options.zoom_unit}var o=t(".draw",n.elem).position().top,r=t(".draw",n.elem).position().left;o=o/i-o/n.zoom_n,r=r/i-r/n.zoom_n,n.zoom_shift={top:o,left:r},n.resize()},e.prototype.dragStart=function(){var e=this;t(".drag",e.elem).draggable({containment:"parent",scroll:!1,drag:function(){e.drawResize()},stop:function(){e.dragNavDiff()}});var n=t(".nav",this.elem).offset();t(".drag",e.elem).css({left:n.left,top:n.top})},e.prototype.scrollStart=function(){var e=this,n=t(".nav",e.elem),i=t(".drag",e.elem),o=t(".view",e.elem),r=function(t){var o=t.originalEvent.deltaX/4,r=t.originalEvent.deltaY/4,a=n.position(),s=i.position(),u=n.width(),c=n.height(),l=i.width(),h=i.height(),p=a.left+u-l,d=a.top+c-h,m=s.top+r,f=s.left+o;m=m<a.top?a.top:m,f=f<a.left?a.left:f,m=m>d?d:m,f=f>p?p:f,i.css("top",m+"px"),i.css("left",f+"px"),s=i.position(),e.dragHandler(a,s),e.dragNavDiff(),t.preventDefault()};t(n).on("wheel",r),t(o).on("wheel",r)},e.prototype.dragHandler=function(t,e){var n=this,i=e.left-t.left,o=e.top-t.top,r=-1*i*n.zoom_n*n.nav_scale,a=-1*o*n.zoom_n*n.nav_scale;n.drawMove(r,a)},e.prototype.dragResize=function(){var e=this,n=t(".view",e.elem),i=t(".draw",e.elem),o=n.width()/i.width();o=o>1?1:o;var r=n.height()/i.height();r=r>1?1:r;var a=t(".nav img",e.elem),s=a.width()*o,u=a.height()*r,c=t(".nav",e.elem).offset().left,l=t(".nav",e.elem).offset().top;t(".drag",e.elem).css({width:s,height:u,left:c+e.dragDiff.left,top:l+e.dragDiff.top}),e.zoom_shift=null},e.prototype.drawMove=function(e,n){t(".draw",this.elem).css({left:e,top:n})},e.prototype.drawResize=function(){var e=this;t(".draw",e.elem).css({width:e.orig_w*e.zoom_n,height:e.orig_h*e.zoom_n});var n=t(".nav",e.elem).position(),i=t(".drag",e.elem).position();e.dragHandler(n,i)},e.prototype.navResize=function(){var e=this,n=t(".nav",e.elem).height();e.nav_scale=e.orig_h/n,t(".nav img",e.elem).css({height:n}),e.navLiteRedraw()},e.prototype.viewResize=function(){var e=t(this.elem).width();t(".view",this.elem).css({width:e})},e.prototype.viewMousePos=function(e){var n=t(".view",this.elem).position(),i=void 0!=e.clientX?e.clientX+t(window).scrollLeft():e.originalEvent.pageX,o=void 0!=e.clientY?e.clientY+t(window).scrollTop():e.originalEvent.pageY;return{left:i-n.left,top:o-n.top}},e.prototype.goTo=function(e,n,i){var o=this;e=void 0==e?0:e,n=void 0==n?0:n,i=void 0==i?o.options.secs:i;var r=t(".nav",this.elem).position(),a=t(".nav",this.elem).width(),s=t(".nav",this.elem).height(),u=t(".drag",this.elem).width(),c=t(".drag",this.elem).height(),l=e/o.nav_scale+r.left,h=n/o.nav_scale+r.top;l=l<r.left?r.left:l,h=h<r.top?r.top:h;var p=r.left+a-u,d=r.top+s-c;l=l>p?p:l,h=h>d?d:h,t(".drag",o.elem).animate({left:l,top:h},{duration:1e3*i,step:function(){var e=t(".drag",this.elem).position();o.dragHandler(r,e)}})},e.prototype.load=function(t){for(var e=0;e<t.length;e++)coords=this.relToExp(t[e]),this.liteAdd(coords.x1,coords.y1,coords.x2,coords.y2)},e.prototype.relToExp=function(t){var e={x1:null,x2:null,y1:null,y2:null};return e.x1=Math.round(t.x*this.orig_w),e.y1=Math.round(t.y*this.orig_h),e.x2=Math.round(e.x1+t.width*this.orig_w),e.y2=Math.round(e.y1+t.height*this.orig_h),e},e.prototype.export=function(){},jQuery(document).ready(function(t){jQuery.fn.imgspect=function(t){var n=jQuery(this).selector;return this.each(function(){jQuery.data(this,n,new e(this,t,n))})}})}(jQuery);